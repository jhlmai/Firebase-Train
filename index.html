<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Employee Tracker</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">
    <script src="https://use.fontawesome.com/1fba92214c.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.8.0/firebase.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>
</head>

<body>
    <div class="container">
        <div class="jumbotron">
            <h1>
                <i class="fa fa-newspaper-o" aria-hidden="true"></i>Train Schedule</h1>
        </div>
      <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">
                        <i class="fa fa-table" aria-hidden="true"></i> Current Train Schedule</h3>
            </div>
            <div class="panel-body">
                <div id="result">
    <table class="table table-striped" id="ourTable">
    <thead>
      <tr>
        <th>Train Name</th>
        <th>Destination</th>
        <th>Frequency (min)</th>
        <th >Next Arrival</th>
        <th>Minutes Away</th>
      </tr>
    </thead>
    <tbody id="tableBody">
    

      
    </tbody>
  </table>
</div>
                </div>
            </div>
        
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">
                    <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span> Add Train</h3>
              
            </div>
            <div class="panel-body">
                <form action="/action_page.php">
                    <div class="form-group">
                        <label for="search">Train Name</label>
                        <input type="search" class="form-control" id="name">
                    </div>
                    <div class="form-group">
                        <label for="number">Destination</label>
                        <input type="text" class="form-control" id="role">
                    </div>
                    <div class="form-group">
                        <label for="start-yr">First Train Time (HH:mm - military time)</label>
                        <input type="start-yr" class="form-control" id="start-yr">
                    </div>
                    <div class="form-group">
                        <label for="end-yr">Frequency (min)</label>
                        <input type="end-yr" class="form-control" id="rate">
                    </div>
                    <button type="submit" class="btn btn-default" id="search-btn"><span class="glyphicon glyphicon-search
                        " aria-hidden="true"></span> Submit</button>
                   
                </form>
            </div>
        </div>
  </div>    

      <script>
  var config = {
    apiKey: "AIzaSyBe_fQcm5m7qOrOK053j2hjpf1RRRUJors",
    authDomain: "fir-train-172ba.firebaseapp.com",
    databaseURL: "https://fir-train-172ba.firebaseio.com",
    projectId: "fir-train-172ba",
    storageBucket: "",
    messagingSenderId: "930485159817"
  };
  firebase.initializeApp(config);
    var database = firebase.database();
    
        
    		$("#search-btn").on("click", function (event) {
        	event.preventDefault();
          
         
          var employeeData =($("#name").val());
        
          var roleData = ($("#role").val());
         
          var startYearData = ($("#start-yr").val());
         
        
        
          
          database.ref().push({
          employee: employeeData,
          role: roleData,
          startYear: startYearData,
          dateAdded: firebase.database.ServerValue.TIMESTAMP,
          
          });
          
          });         
          
          database.ref().on("child_added", function (childSnapshot) {
            
            console.log(childSnapshot.val().employee);
            console.log(childSnapshot.val().role);
            console.log(childSnapshot.val().startYear);
            console.log(childSnapshot.val().dateAdded);
            
            var row = $("<tr>"); 
            row.append("<td id='employee_'> " + childSnapshot.val().employee + 
                       " </td><td id = 'role_'> " + childSnapshot.val().role + 
                       " </td><td id = 'startYear_'> " + childSnapshot.val().startYear + 
                       " </td><td id = 'dateAdded_'> " + childSnapshot.val().dateAdded + " </td>");
              $("#tableBody").append(row);
              
              var monthsWorked = moment().diff(moment.unix(parseInt(childSnapshot.val().startYear), "X"), "months");
              console.log(monthsWorked);
            });
      </script>
</body>
</html>